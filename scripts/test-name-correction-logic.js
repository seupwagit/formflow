/**
 * üß™ TESTE DA L√ìGICA DE CORRE√á√ÉO DE NOMES
 * Execute no console para verificar se a l√≥gica est√° funcionando corretamente
 */

console.log('üß™ TESTANDO L√ìGICA DE CORRE√á√ÉO DE NOMES...')

// Simular fun√ß√£o shouldShowNameCorrection
function shouldShowNameCorrection(field) {
  if (!field || !field.name || !field.id) return false
  
  // Fun√ß√£o sanitizeFieldName simulada
  const sanitizeFieldName = (text) => {
    return text.toLowerCase()
      .replace(/[^a-z0-9\s]/g, '')
      .replace(/\s+/g, '_')
      .replace(/^[^a-z]/, 'field_')
  }
  
  // 1. Se o nome j√° est√° em formato v√°lido snake_case, N√ÉO mostrar corre√ß√£o
  const hasValidFormat = /^[a-z][a-z0-9_]*$/.test(field.name)
  const isReasonableLength = field.name.length <= 50
  
  // 2. Se o nome foi sanitizado corretamente do label, N√ÉO mostrar corre√ß√£o
  const expectedFromLabel = sanitizeFieldName(field.label || '')
  const isBasedOnLabel = field.name.startsWith(expectedFromLabel) || field.name === expectedFromLabel
  
  // 3. Se o nome n√£o tem caracteres problem√°ticos, N√ÉO mostrar corre√ß√£o
  const hasProblematicChars = /[^a-z0-9_]/.test(field.name)
  
  // 4. Se o campo foi corrigido recentemente (nome v√°lido), N√ÉO mostrar
  if (hasValidFormat && isReasonableLength && !hasProblematicChars) {
    console.log('‚úÖ Campo com nome v√°lido, n√£o mostrando corre√ß√£o:', field.name)
    return false
  }
  
  // 5. Verificar se √© um ID muito longo gerado automaticamente
  const isAutoGeneratedId = field.name.includes('_') && field.name.length > 30
  const hasTimestamp = /\d{6,}/.test(field.name)
  
  // S√≥ mostrar corre√ß√£o se h√° problemas REAIS
  const shouldShow = hasProblematicChars || (isAutoGeneratedId && hasTimestamp)
  
  return shouldShow
}

// Casos de teste
const testCases = [
  // ‚úÖ Casos que N√ÉO devem mostrar corre√ß√£o (j√° corretos)
  {
    name: 'deposito_contrib_social',
    label: '13-DEP√ìSITO + CONTRIB SOCIAL',
    expected: false,
    reason: 'Nome j√° sanitizado corretamente'
  },
  {
    name: 'nome_completo',
    label: 'Nome Completo',
    expected: false,
    reason: 'Nome em formato v√°lido'
  },
  {
    name: 'data_nascimento',
    label: 'Data de Nascimento',
    expected: false,
    reason: 'Nome snake_case v√°lido'
  },
  
  // ‚ùå Casos que DEVEM mostrar corre√ß√£o (problem√°ticos)
  {
    name: 'field_13_deposito_contrib_social_0_101_250_120174_12',
    label: '13-DEP√ìSITO + CONTRIB SOCIAL',
    expected: true,
    reason: 'ID muito longo gerado automaticamente'
  },
  {
    name: 'Nome Completo',
    label: 'Nome Completo',
    expected: true,
    reason: 'Tem espa√ßos e mai√∫sculas'
  },
  {
    name: 'campo-com-h√≠fen',
    label: 'Campo com H√≠fen',
    expected: true,
    reason: 'Tem h√≠fens (caracteres problem√°ticos)'
  },
  {
    name: 'CAMPO_MAIUSCULO',
    label: 'Campo Mai√∫sculo',
    expected: true,
    reason: 'Tem letras mai√∫sculas'
  }
]

console.log('üìã EXECUTANDO TESTES...')
console.log('')

let passedTests = 0
let totalTests = testCases.length

testCases.forEach((testCase, index) => {
  const field = {
    id: `field_${index}`,
    name: testCase.name,
    label: testCase.label
  }
  
  const result = shouldShowNameCorrection(field)
  const passed = result === testCase.expected
  
  const status = passed ? '‚úÖ PASSOU' : '‚ùå FALHOU'
  const icon = testCase.expected ? 'üîß' : '‚úÖ'
  
  console.log(`${status} Teste ${index + 1}: ${icon} "${testCase.name}"`)
  console.log(`   Esperado: ${testCase.expected ? 'Mostrar corre√ß√£o' : 'N√ÉO mostrar corre√ß√£o'}`)
  console.log(`   Resultado: ${result ? 'Mostrar corre√ß√£o' : 'N√ÉO mostrar corre√ß√£o'}`)
  console.log(`   Raz√£o: ${testCase.reason}`)
  console.log('')
  
  if (passed) passedTests++
})

// Resumo
console.log('=' .repeat(50))
console.log('üìä RESUMO DOS TESTES')
console.log('=' .repeat(50))
console.log(`‚úÖ Testes passaram: ${passedTests}/${totalTests}`)
console.log(`üìà Taxa de sucesso: ${Math.round((passedTests / totalTests) * 100)}%`)

if (passedTests === totalTests) {
  console.log('üéâ TODOS OS TESTES PASSARAM!')
  console.log('‚úÖ L√≥gica de corre√ß√£o funcionando perfeitamente')
  console.log('üí° Sistema s√≥ mostrar√° corre√ß√£o quando realmente necess√°rio')
} else {
  console.log('‚ö†Ô∏è ALGUNS TESTES FALHARAM')
  console.log('üîß Verificar l√≥gica da fun√ß√£o shouldShowNameCorrection')
}

console.log('')
console.log('üéØ COMPORTAMENTO ESPERADO:')
console.log('‚Ä¢ Campos com nomes v√°lidos: N√ÉO mostrar corre√ß√£o')
console.log('‚Ä¢ Campos j√° corrigidos: N√ÉO mostrar corre√ß√£o')  
console.log('‚Ä¢ Campos com problemas reais: Mostrar corre√ß√£o')
console.log('‚Ä¢ IDs muito longos: Mostrar corre√ß√£o')

return {
  passedTests,
  totalTests,
  successRate: Math.round((passedTests / totalTests) * 100)
}